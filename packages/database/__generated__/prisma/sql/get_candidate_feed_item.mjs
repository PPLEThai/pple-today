
/* !!! This is code generated by Prisma. Do not edit directly. !!!
/* eslint-disable */
import { makeTypedQueryFactory as $mkFactory } from "../runtime/client"
export const get_candidate_feed_item = /*#__PURE__*/ $mkFactory("WITH\ncandidate_feed_item AS (\nSELECT *\nFROM\nget_candidate_feed_item_by_follower ($1)\nUNION ALL\nSELECT *\nFROM\nget_candidate_feed_item_by_interaction ($1)\nUNION ALL\nSELECT *\nFROM\nget_candidate_feed_item_by_topic ($1)\n),\naggregated_feed_items AS (\nSELECT candidate_feed_item.feed_item_id, SUM(candidate_feed_item.score) AS score\nFROM candidate_feed_item\nGROUP BY\ncandidate_feed_item.feed_item_id\n),\npublished_feed_items AS (\nSELECT\nfi.\"id\" AS id,\nfi.\"publishedAt\" AS published_at\nFROM\n\"Poll\" p\nINNER JOIN \"FeedItem\" fi ON fi.\"id\" = p.\"feedItemId\"\nWHERE p.\"status\" = 'PUBLISHED' AND fi.\"publishedAt\" <= NOW()\nUNION ALL\nSELECT\nfi.\"id\" AS id,\nfi.\"publishedAt\" AS published_at\nFROM\n\"Post\" p\nINNER JOIN \"FeedItem\" fi ON fi.\"id\" = p.\"feedItemId\"\nWHERE p.\"status\" = 'PUBLISHED' AND fi.\"publishedAt\" <= NOW()\n),\nother_feed_items AS (\nSELECT\npfi.id AS feed_item_id,\n(RANDOM () / 100) * EXP(-LEAST(extract(EPOCH FROM (NOW() - pfi.published_at)) / 86400, 30)) AS score\nFROM\npublished_feed_items pfi\nLEFT JOIN aggregated_feed_items afi ON afi.feed_item_id = pfi.id\nWHERE\nafi.feed_item_id IS NULL\n),\nfinal_candidate_score AS (\nSELECT other_feed_items.feed_item_id, other_feed_items.score\nFROM other_feed_items\nUNION ALL\nSELECT aggregated_feed_items.feed_item_id, aggregated_feed_items.score\nFROM aggregated_feed_items\nORDER BY score DESC\nLIMIT 1000\n)\n\nSELECT\nfinal_candidate_score.\"feed_item_id\",\nfinal_candidate_score.\"score\"\nFROM\nfinal_candidate_score;")
