enum FeedItemType {
  POST
  POLL
  ANNOUNCEMENT
}

enum FeedItemReactionType {
  UP_VOTE
  DOWN_VOTE
}

enum FeedItemReactionLogType {
  UP_VOTE
  DOWN_VOTE
  REMOVE_VOTE
}

enum FeedItemCommentAction {
  CREATE
  UPDATE
  DELETE
}

model FeedItem {
  id   String       @id @default(cuid())
  type FeedItemType

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  publishedAt DateTime?

  numberOfComments Int @default(0)

  authorId String
  author   User   @relation(fields: [authorId], references: [id])

  post         Post?
  poll         Poll?
  announcement Announcement?

  reactions           FeedItemReaction[]
  reactionLogs        FeedItemReactionLog[]
  comments            FeedItemComment[]
  reactionCounts      FeedItemReactionCount[]
  feedItemScores      FeedItemScore[]
  feedItemCommentLogs FeedItemCommentLog[]

  @@index([createdAt])
}

model FeedItemScore {
  userId     String
  feedItemId String
  score      Float  @default(0)

  expiresAt DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User     @relation(fields: [userId], references: [id])
  feedItem FeedItem @relation(fields: [feedItemId], references: [id], onDelete: Cascade)

  @@id([userId, feedItemId])
  @@index([feedItemId])
  @@index([userId])
}

model FeedItemReaction {
  userId     String
  feedItemId String

  type FeedItemReactionType

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User     @relation(fields: [userId], references: [id])
  feedItem FeedItem @relation(fields: [feedItemId], references: [id], onDelete: Cascade)

  @@id([userId, feedItemId])
  @@index([feedItemId])
  @@index([userId])
  @@index([createdAt])
}

model FeedItemReactionLog {
  id         String @id @default(cuid())
  userId     String
  feedItemId String

  type FeedItemReactionLogType

  createdAt DateTime @default(now())

  user     User     @relation(fields: [userId], references: [id])
  feedItem FeedItem @relation(fields: [feedItemId], references: [id], onDelete: Cascade)

  @@index([feedItemId])
  @@index([userId])
  @@index([createdAt])
}

model FeedItemReactionCount {
  feedItemId String
  type       FeedItemReactionType

  count Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  feedItem FeedItem @relation(fields: [feedItemId], references: [id], onDelete: Cascade)

  @@id([feedItemId, type])
}

model FeedItemComment {
  id         String @id @default(cuid())
  userId     String
  feedItemId String

  content String

  isPrivate Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User                 @relation(fields: [userId], references: [id])
  feedItem FeedItem             @relation(fields: [feedItemId], references: [id], onDelete: Cascade)
  comments FeedItemCommentLog[]

  @@index([feedItemId])
  @@index([userId])
  @@index([createdAt])
}

model FeedItemCommentLog {
  id         String @id @default(cuid())
  userId     String
  feedItemId String
  action     String

  content   String?
  commentId String?
  isPrivate Boolean?

  createdAt DateTime @default(now())

  user     User             @relation(fields: [userId], references: [id])
  feedItem FeedItem         @relation(fields: [feedItemId], references: [id], onDelete: Cascade)
  comment  FeedItemComment? @relation(fields: [commentId], references: [id], onDelete: SetNull)
}
