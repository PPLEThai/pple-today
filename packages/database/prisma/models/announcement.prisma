enum AnnouncementType {
    OFFICIAL
    PARTY_COMMUNICATE
    INTERNAL
}

// Published Announcement model
model Announcement {
    feedItemId String           @id
    title      String
    content    String?
    type       AnnouncementType

    topics      AnnouncementTopic[]
    attachments AnnouncementFile[]

    feedItem FeedItem @relation(fields: [feedItemId], references: [id], onDelete: Cascade)
}

model AnnouncementTopic {
    announcementId String
    topicId        String

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    announcement Announcement @relation(fields: [announcementId], references: [feedItemId], onDelete: Cascade)
    topic        Topic        @relation(fields: [topicId], references: [id], onDelete: Cascade)

    @@id([announcementId, topicId])
    @@index([topicId])
    @@index([announcementId])
}

model AnnouncementFile {
    id             String   @id @default(cuid())
    announcementId String
    filePath       String
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt

    announcement Announcement @relation(fields: [announcementId], references: [feedItemId], onDelete: Cascade)

    @@index([announcementId])
}

// Draft Announcement model
model AnnouncementDraft {
    id      String            @id @default(cuid())
    title   String?
    content String?
    type    AnnouncementType?

    topics      AnnouncementTopicDraft[]
    attachments AnnouncementFileDraft[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model AnnouncementTopicDraft {
    announcementDraftId String
    topicId             String

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    announcementDraft AnnouncementDraft @relation(fields: [announcementDraftId], references: [id], onDelete: Cascade)
    topic             Topic             @relation(fields: [topicId], references: [id], onDelete: Cascade)

    @@id([announcementDraftId, topicId])
}

model AnnouncementFileDraft {
    id                  String   @id @default(cuid())
    announcementDraftId String
    filePath            String
    createdAt           DateTime @default(now())
    updatedAt           DateTime @updatedAt

    announcementDraft AnnouncementDraft @relation(fields: [announcementDraftId], references: [id], onDelete: Cascade)

    @@index([announcementDraftId])
}
