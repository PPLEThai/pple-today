enum ElectionType {
    ONSITE
    ONLINE
    HYBRID
}

enum EligibleVoterType {
    ONSITE
    ONLINE
}

enum ElectionResultType {
    ONSITE
    ONLINE
}

enum ElectionMode {
    SECURE
    FLEXIBLE
}

model Election {
    id                        String       @id @default(cuid())
    name                      String
    description               String?
    location                  String?
    locationMapUrl            String?
    type                      ElectionType
    mode                      ElectionMode @default(SECURE)
    encryptionPublicKey       String?
    digitalSignaturePublicKey String?
    isCancelled               Boolean      @default(false)

    publishDate   DateTime?
    openRegister  DateTime?
    closeRegister DateTime?
    openVoting    DateTime
    closeVoting   DateTime
    startResult   DateTime?
    endResult     DateTime?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    candidates  ElectionCandidate[]
    voters      ElectionEligibleVoter[]
    voteRecords ElectionVoteRecord[]
    ballots     ElectionBallot[]

    @@index([name])
}

model ElectionCandidate {
    id               String  @id @default(cuid())
    electionId       String
    name             String
    description      String?
    profileImagePath String?
    number           Int?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    election Election @relation(fields: [electionId], references: [id], onDelete: Cascade)

    results ElectionResult[]

    @@index(electionId)
}

model ElectionEligibleVoter {
    electionId String
    userId     String
    type       EligibleVoterType

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    election Election @relation(fields: [electionId], references: [id], onDelete: Cascade)
    user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@id([electionId, userId])
    @@index(userId)
}

model ElectionVoteRecord {
    electionId    String
    userId        String
    ballotId      String?  @unique
    location      String?
    faceImagePath String?
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt

    election Election        @relation(fields: [electionId], references: [id], onDelete: Cascade)
    user     User            @relation(fields: [userId], references: [id], onDelete: Cascade)
    ballot   ElectionBallot? @relation(fields: [ballotId], references: [id], onDelete: SetNull)

    @@id([electionId, userId])
    @@index(userId)
}

model ElectionBallot {
    id              String   @id @default(cuid())
    electionId      String
    encryptedBallot String
    createdAt       DateTime @default(now())
    updatedAt       DateTime @updatedAt

    election   Election            @relation(fields: [electionId], references: [id], onDelete: Cascade)
    voteRecord ElectionVoteRecord?

    @@index(electionId)
}

model ElectionResult {
    id          String             @id @default(cuid())
    candidateId String
    type        ElectionResultType
    count       Int                @default(0)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    candidate ElectionCandidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

    @@unique([candidateId, type])
}
