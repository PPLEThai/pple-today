enum NotificationLinkType {
  MINI_APP
  IN_APP_NAVIGATION
  EXTERNAL_BROWSER
}

model UserNotificationToken {
  token  String @id
  userId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}

model Notification {
  id        String                @id @default(cuid())
  title     String
  message   String
  image     String?
  linkType  NotificationLinkType?
  linkValue String?

  isBroadcast Boolean  @default(false)
  roles       String[]
  provinces   String[]
  districts   String[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sentNotifications UserNotification[]
  phoneNumbers      NotificationPhoneNumber[]
}

model NotificationPhoneNumber {
  notificationId String
  phoneNumber    String

  notification Notification @relation(fields: [notificationId], references: [id])

  @@id([notificationId, phoneNumber])
  @@index([phoneNumber])
}

model UserNotification {
  userId         String
  notificationId String

  isRead Boolean   @default(false)
  readAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user         User         @relation(fields: [userId], references: [id])
  notification Notification @relation(fields: [notificationId], references: [id])

  @@id([userId, notificationId])
  @@index([notificationId])
  @@index([userId])
}

model NotificationApiKey {
  id     String  @id @default(cuid())
  name   String
  apiKey String  @unique
  active Boolean @default(true)

  createdAt DateTime                     @default(now())
  updatedAt DateTime                     @updatedAt
  usageLogs NotificationApiKeyUsageLog[]

  @@index([active, apiKey])
}

model NotificationApiKeyUsageLog {
  id                   String   @id @default(cuid())
  notificationApiKeyId String
  usedAt               DateTime @default(now())
  body                 Json

  notificationApiKey NotificationApiKey @relation(fields: [notificationApiKeyId], references: [id])

  @@index([notificationApiKeyId])
  @@index([usedAt])
}
